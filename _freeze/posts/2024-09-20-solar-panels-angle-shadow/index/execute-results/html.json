{
  "hash": "2d51456d790d3d8d8790c84d6f862b12",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Calculating the length of a shadow from solar panels\"\ndescription: I have recently worked on preparing a flat roof for solar panels. An important propterty when figuring out how many rows of panels one can include is to calculate the length of the shadow cast by panels. Though, can you use R to calculate this? \nauthor:\n  - name: Erik H. K\ndate: 09-20-2024\ncategories: [R, DIY, solar]\nimage: Row_spacing2.jpg\ndraft: false \n---\n\n\n# Calculating Inter-row Spacing for Solar Panels\n\nWhen installing solar panels on a flat roof, one of the most important factors to consider is the spacing between rows of panels. This is to ensure that the shadow cast by one row does not fall on the row behind it, which would reduce efficiency. In this post, I will show how to use R to calculate the length of the shadow cast by solar panels and, therefore, the required spacing between the rows.\n\n## Step 1: Calculate the Horizontal Length of the Panel\n\n![](Skærmbillede%202024-09-26%20kl.%2013.43.42.png){fig-align=\"center\"}\n\nThe first calculation we need to perform is the horizontal length of the solar panel, which depends on the panel’s tilt angle. The formula for the horizontal projection of a panel can be derived from basic trigonometry. Firstly, we need to find the side $b$ of the triangle, which can be done using the following relationship: \n\n$$\ncos(A)=\\frac{b}{c}\n$$\nwhere:\n- $( A )$ is the tilt angle of the panel.\n- $( b )$ is the horizontal length of the panel.\n- $( c )$ is the height of the panel.\n\nWhen isolating $b$ we get:\n$$\ncos(A)c=b\n$$\n\nIn this example, the height of the panel $( c )$ is 1.1 meters, and the tilt angle $( A )$ is $( 13^\\circ )$. The following R code calculates the horizontal length (note that we convert degrees to radians):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate the horizontal length of the panel\np_l <- 1.1 * cos(13 * pi / 180)\np_l  # Display the horizontal length in meters\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.071807\n```\n\n\n:::\n:::\n\n\n## Step 2: Calculate the Shadow Cast by the Panel\n\nNext, we calculate the shadow length $(d)$ cast by the panel, which depends on the angle of the sun $(\\beta)$ and the panel's vertical height:\n\n$$\nd = \\frac{a}{tan(\\beta)}\n$$\n\nWhere:\n\n- $(a)$ is the vertical height of the panel, adjusted by the sine of the tilt angle.\n- $(\\beta)$ is the angle of the sun.\n\nUsing the property $a=sin⁡(A)$, we substitute:\n\n$$\n= \\frac{sin(A)\\cdot c}{tan(\\beta)}\n$$\n\nIn order to find data on the sun angle I use the ```suncalc``` package. Here's how to do it in R:\n\n### Load the Required Libraries:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(suncalc)\nlibrary(lubridate)\nlibrary(ggplot2)\n```\n:::\n\n### Get the Sun's Angle for Each Month:\nHere I use the first day of the month and noon as the time of day:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fetch sun's angle (altitude) for each month at noon\nsunALT_df <- getSunlightPosition(\n  date = ymd_hm(\"2024/01/01 12:00\") + months(seq(0, 11)),\n  lat = 55, \n  lon = 12,\n  keep = c(\"altitude\")\n)\n\n# Convert altitude from radians to degrees\nsunALT_df$altitude_deg <- sunALT_df$altitude * (180 / pi)\nsunALT_df  # Display sun angle data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  date lat lon  altitude altitude_deg\n1  2024-01-01 12:00:00  55  12 0.1984576     11.37078\n2  2024-02-01 12:00:00  55  12 0.3029835     17.35968\n3  2024-03-01 12:00:00  55  12 0.4733542     27.12120\n4  2024-04-01 12:00:00  55  12 0.6791656     38.91332\n5  2024-05-01 12:00:00  55  12 0.8552644     49.00304\n6  2024-06-01 12:00:00  55  12 0.9740378     55.80826\n7  2024-07-01 12:00:00  55  12 0.9958690     57.05909\n8  2024-08-01 12:00:00  55  12 0.9091945     52.09300\n9  2024-09-01 12:00:00  55  12 0.7364647     42.19632\n10 2024-10-01 12:00:00  55  12 0.5315600     30.45614\n11 2024-11-01 12:00:00  55  12 0.3341991     19.14820\n12 2024-12-01 12:00:00  55  12 0.2117176     12.13053\n```\n\n\n:::\n:::\n\n\n## Step 3: Calculate the Shadow Length for Each Month\nNow, we can calculate the shadow length for each month based on the sun's angle and the height of the panel.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate the vertical height of the panel\na <- 1.1 * sin(13 * pi / 180)\n\n# Calculate the shadow length for each month\nd <- a / tan(sunALT_df$altitude)\nd  # Display shadow lengths\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 1.2304344 0.7915535 0.4831113 0.3065175 0.2150786 0.1681121 0.1603308\n [8] 0.1926801 0.2729304 0.4208164 0.7126426 1.1512404\n```\n\n\n:::\n:::\n\n\n## Step 4: Add the Length of the Panel to Get Total Row Spacing\nFinally, we add the panel’s horizontal length to the shadow length to get the total spacing required for each row of panels. We can visualize this spacing for each month of the year using a bar plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate total required row spacing\ntot_w <- d + p_l\nw_df <- data.frame(total_width = tot_w, month = sunALT_df$date)\n\n# Calculate row spacing for 3 and 4 rows\nrow3 <- (7.27 - p_l) / 3\nrow4 <- (7.27 - p_l) / 4\n\n# Plot the required row spacing for each month\nggplot(data = w_df, aes(x = as.Date(month), y = total_width)) + \n  geom_bar(stat = \"identity\", width = 0.1, color = \"blue\") + \n  geom_point() + \n  geom_hline(yintercept = c(row3, row4), linetype = \"dashed\") + \n  scale_x_date(date_labels = \"%b\", date_breaks = \"1 month\") + \n  labs(x = \"Month\", y = \"Total Row Spacing (meters)\") + \n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nIn the plot, the dashed lines represent the spacing for 3 rows and 4 rows, allowing you to see how the shadow length changes throughout the year and how it affects the required spacing.\n\nBy following these steps, you can calculate the optimal row spacing for solar panels to avoid shading, ensuring maximum energy efficiency throughout the year.",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}